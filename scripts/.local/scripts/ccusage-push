#!/bin/bash
set -euo pipefail

# Push local Claude Code usage data to popos for aggregation.
# Intended to run as a cron job on each machine.

HOSTNAME="$(hostname)"
PROJECTS_DIR="$HOME/.claude/projects"

if [[ ! -d "$PROJECTS_DIR" ]]; then
    exit 0
fi

REMOTE_DIR="~/.claude/remote/$HOSTNAME/projects"
ssh popos "mkdir -p $REMOTE_DIR"

rsync -az --delete \
    "$PROJECTS_DIR/" \
    "popos:$REMOTE_DIR/"
